#!/bin/zsh

BAR_WIDTH=80
TOMTIM_STATUS="/run/user/`id -u`/tomtim"

round() { echo $1 | awk '{printf("%d\n",$1 + 0.5)}' }

progress_bar() {
  local percent=$1
  local bar_length=$(($BAR_WIDTH - 12))
  local octothorpes=$(round $((bar_length * (percent / 100))))
  local gaps=$((bar_length - octothorpes))
  echo -n '[ '
  for n ({0..$octothorpes}) { echo -n '#' }
  for n ({0..$gaps}) { echo -n ' ' }
  echo -n "] $(round $percent)%"
}

tomtim_progress() {
  let "time_total=`head -n 1 $TOMTIM_STATUS`"
  let "time_left=`tail -n 1 $TOMTIM_STATUS`"

  progress_bar $(((time_left * 100.0) / time_total))
}

tomtim_progress
